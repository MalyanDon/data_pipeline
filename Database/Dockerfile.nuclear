# ===================================================
# NUCLEAR OPTION - COMPLETE REBUILD
# ===================================================

FROM node:18-alpine

# Set working directory
WORKDIR /app

# Install system dependencies
RUN apk add --no-cache python3 py3-pip make g++ postgresql-client

# Copy everything first
COPY . .

# Install dependencies
RUN npm install --production

# Create upload directory
RUN mkdir -p temp_uploads

# CRITICAL: Verify the file exists and show everything
RUN echo "=== NUCLEAR VERIFICATION ===" && \
    echo "📁 Current directory:" && pwd && \
    echo "📁 All files:" && ls -la && \
    echo "📁 JavaScript files:" && ls -la *.js && \
    echo "📦 Package.json:" && cat package.json && \
    echo "📄 Main file content (first 5 lines):" && head -5 working-upload-system.js

# Expose port
EXPOSE 3000

# Use direct node command instead of npm start
CMD ["node", "working-upload-system.js"] 